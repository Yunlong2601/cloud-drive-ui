Context
I’m building a secure document sharing web app called FortiFile. Stack: Flask (Python) + PostgreSQL + HTML/CSS/JS.

Task
Add Yunlong’s security module (RBAC + MAC + Auth/Sessions + Audit Logs + Admin Dashboard + Incident Tracking) without changing or removing existing features.

Database: PostgreSQL (IMPORTANT)

Use PostgreSQL SQL syntax and features where helpful (UUID, enums/check constraints, indexes).

Provide full CREATE TABLE schema + relations + sample seed roles/permissions.

1) RBAC (Role-Based Access Control)

Tables: users, roles, permissions, user_roles, role_permissions

Roles: admin, staff, student

Permissions examples: file.upload, file.download, file.share, admin.view_logs, admin.manage_roles, incident.manage

Implement backend helpers: has_permission(user_id, perm) and decorators/middleware to protect routes.

2) MAC (Mandatory Access Control)

Add clearance levels for users and classification levels for files: public, confidential, restricted

Enforce rule: user can only access files at or below their clearance

Implement check in every file download/view/share endpoint.

3) Authentication + Session Handling

Secure password hashing using bcrypt or Argon2

Use server-side sessions or JWT (choose one and implement fully)

Login, logout, session expiry, protected routes

Log successful/failed login attempts into audit logs.

4) Audit Logging

Create audit_logs table with: id, created_at, user_id, action, target_type, target_id, ip, user_agent, result, details (jsonb)

Log actions: login attempts, upload/download, share, role/permission changes, MAC denials, incident updates.

Add indexes for fast filtering by time/user/action.

5) Admin Security Dashboard (Admin only)

Page to view audit logs with filters: date range, user, action, result

Show “top suspicious events” (e.g., many failed logins, repeated MAC denials).

6) Incident Reporting + Tracking

Create incidents table: id, created_at, created_by, status (open/investigating/resolved), severity (low/med/high), title, description, related_audit_log_id

Admin can create incident from an audit log entry and update status.

UI requirements

Simple clean admin dashboard (no fancy design)

Clear “Access Denied” messages stating RBAC vs MAC reason

Rules

Do NOT rewrite other modules

Keep code modular, readable, commented

Provide working Flask routes + SQL schema + minimal templates/pages to demo.